# cloud-config webserver
---
version: v1
packages_update: true
packages_upgrade: true

packages:
  - tomcat9
  - awscli

runcmd:
  - echo ===== Waiting an artifcat s3://${bucket}/${file} =====
  - while true; do sleep 5; aws s3 ls s3://${bucket}/${file}; [ "$?" -eq 1 ] || break; done
  - aws s3 cp s3://${bucket}/${file} ${webdir}/${webroot}.war
  - aws s3 rm s3://${bucket}/${file}
  - rm -rf ${webdir}/${webroot}/
